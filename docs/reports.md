# Reports API Documentation

## Overview

The Reports API provides comprehensive analytics and insights into SMS marketing performance. It offers detailed metrics for campaigns, automations, messaging, and revenue attribution with professional-grade reporting capabilities.

## Key Features

- **Comprehensive Analytics**: Overview, campaigns, automations, messaging, and revenue reports
- **Advanced Metrics**: Delivery rates, click rates, revenue attribution, and performance tracking
- **Time Series Data**: Daily messaging performance and trends
- **Campaign Attribution**: Track revenue and orders generated by campaigns
- **Automation Analytics**: Monitor automation performance and ROI
- **Revenue Tracking**: Detailed revenue analysis by campaign and automation
- **Export Functionality**: Export reports in JSON or CSV format
- **Date Range Filtering**: Flexible date range selection for analysis
- **Professional Dashboards**: Rich visualizations and data tables

## Base URL

```
/reports
```

## Authentication

All endpoints require Shopify session token authentication via the `ensureShopContext` middleware.

## Endpoints

### 1. Overview Report

**GET** `/reports/overview`

Get comprehensive overview metrics including SMS stats, revenue attribution, and performance indicators.

#### Query Parameters

| Parameter | Type   | Default | Description                |
| --------- | ------ | ------- | -------------------------- |
| `from`    | string | -       | Start date (ISO 8601)      |
| `to`      | string | -       | End date (ISO 8601)        |
| `window`  | string | 30d     | Time window (7d, 30d, 90d) |

#### Response

```json
{
  "success": true,
  "data": {
    "overview": {
      "sent": 5000,
      "delivered": 4750,
      "failed": 250,
      "deliveryRate": 95.0,
      "cost": 150.0,
      "optIns": 120,
      "optOuts": 15,
      "attributedOrders": {
        "count": 45,
        "revenue": 2250.0,
        "percentage": 12.5
      },
      "revenueByCampaign": [
        {
          "campaignId": "campaign_123",
          "campaignName": "Summer Sale",
          "revenue": 1200.0,
          "orderCount": 24,
          "discountCode": "SUMMER20"
        }
      ],
      "discountUtilization": {
        "totalCodes": 1000,
        "usedCodes": 150,
        "reservedCodes": 50,
        "availableCodes": 800,
        "utilizationRate": 15.0,
        "reservationRate": 5.0
      }
    },
    "campaignAttribution": [
      {
        "campaignId": "campaign_123",
        "name": "Summer Sale",
        "revenue": 1200.0,
        "orders": 24,
        "via": {
          "discount": 20,
          "utm": 4
        },
        "clicks_lifetime": 180,
        "messaging": {
          "sent": 500,
          "delivered": 475,
          "failed": 25
        }
      }
    ],
    "automationAttribution": {
      "automation": "abandoned_checkout",
      "orders": 12,
      "revenue": 600.0
    },
    "messagingTimeseries": [
      {
        "day": "2024-01-01",
        "sent": 150,
        "delivered": 142,
        "failed": 8,
        "cost": 4.5
      }
    ],
    "walletStats": {
      "balance": 250.0,
      "totalPurchased": 500.0,
      "totalUsed": 250.0,
      "active": true
    },
    "recentCampaigns": [
      {
        "id": "campaign_123",
        "name": "Summer Sale",
        "status": "completed",
        "createdAt": "2024-01-01T00:00:00Z",
        "_count": {
          "recipients": 500
        }
      }
    ],
    "topPerformingCampaigns": [
      {
        "id": "campaign_123",
        "name": "Summer Sale",
        "metrics": {
          "totalSent": 500,
          "totalDelivered": 475,
          "totalClicked": 95,
          "deliveryRate": 95.0,
          "clickRate": 19.0
        }
      }
    ],
    "dateRange": {
      "from": "2024-01-01T00:00:00Z",
      "to": "2024-01-31T23:59:59Z",
      "window": "30d"
    }
  }
}
```

### 2. Campaign Reports

**GET** `/reports/campaigns`

Get detailed campaign analytics with performance metrics.

#### Query Parameters

| Parameter    | Type    | Default | Description                  |
| ------------ | ------- | ------- | ---------------------------- |
| `from`       | string  | -       | Start date (ISO 8601)        |
| `to`         | string  | -       | End date (ISO 8601)          |
| `campaignId` | string  | -       | Specific campaign ID         |
| `limit`      | integer | 20      | Number of campaigns per page |
| `offset`     | integer | 0       | Page offset                  |

#### Response

```json
{
  "success": true,
  "data": {
    "campaigns": [
      {
        "id": "campaign_123",
        "name": "Summer Sale",
        "status": "completed",
        "createdAt": "2024-01-01T00:00:00Z",
        "discount": {
          "id": "discount_123",
          "code": "SUMMER20",
          "value": 20
        },
        "metrics": {
          "totalSent": 500,
          "totalDelivered": 475,
          "totalClicked": 95,
          "deliveryRate": 95.0,
          "clickRate": 19.0
        }
      }
    ],
    "totalCount": 10,
    "campaignStats": {
      "totalCampaigns": 10,
      "totalSent": 5000,
      "totalDelivered": 4750,
      "totalClicked": 950,
      "deliveryRate": 95.0,
      "clickRate": 19.0
    },
    "revenueByCampaign": [
      {
        "campaignId": "campaign_123",
        "campaignName": "Summer Sale",
        "revenue": 1200.0,
        "orderCount": 24,
        "discountCode": "SUMMER20"
      }
    ],
    "pagination": {
      "limit": 20,
      "offset": 0,
      "total": 10,
      "hasMore": false
    },
    "dateRange": {
      "from": "2024-01-01T00:00:00Z",
      "to": "2024-01-31T23:59:59Z"
    }
  }
}
```

### 3. Campaign Details

**GET** `/reports/campaigns/:id`

Get detailed analytics for a specific campaign.

#### Response

```json
{
  "success": true,
  "data": {
    "campaign": {
      "id": "campaign_123",
      "name": "Summer Sale",
      "status": "completed",
      "createdAt": "2024-01-01T00:00:00Z",
      "discount": {
        "id": "discount_123",
        "code": "SUMMER20",
        "value": 20
      },
      "recipients": [
        {
          "id": "recipient_123",
          "status": "delivered",
          "sentAt": "2024-01-01T10:00:00Z",
          "clickedAt": "2024-01-01T10:30:00Z",
          "contact": {
            "id": "contact_123",
            "firstName": "John",
            "lastName": "Doe",
            "phoneE164": "+1234567890"
          }
        }
      ],
      "_count": {
        "recipients": 500
      }
    },
    "analytics": {
      "totalSent": 500,
      "totalDelivered": 475,
      "totalClicked": 95,
      "deliveryRate": 95.0,
      "clickRate": 19.0
    },
    "messagingTimeseries": [
      {
        "day": "2024-01-01",
        "sent": 500,
        "delivered": 475,
        "failed": 25
      }
    ],
    "recipientAnalytics": {
      "totalRecipients": 500,
      "deliveredRecipients": 475,
      "clickedRecipients": 95,
      "deliveryRate": 95.0,
      "clickRate": 19.0
    },
    "revenueAnalytics": {
      "totalRevenue": 1200.0,
      "orderCount": 24,
      "averageOrderValue": 50.0,
      "attributionRate": 12.5
    },
    "dateRange": {
      "from": "2024-01-01T00:00:00Z",
      "to": "2024-01-31T23:59:59Z"
    }
  }
}
```

### 4. Automation Reports

**GET** `/reports/automations`

Get automation analytics and performance metrics.

#### Query Parameters

| Parameter        | Type   | Default | Description              |
| ---------------- | ------ | ------- | ------------------------ |
| `from`           | string | -       | Start date (ISO 8601)    |
| `to`             | string | -       | End date (ISO 8601)      |
| `automationType` | string | -       | Specific automation type |

#### Response

```json
{
  "success": true,
  "data": {
    "automationAttribution": {
      "automation": "abandoned_checkout",
      "orders": 12,
      "revenue": 600.0
    },
    "automationStats": {
      "totalAutomations": 5,
      "activeAutomations": 3,
      "totalSent": 1000,
      "totalDelivered": 950,
      "totalClicked": 190,
      "deliveryRate": 95.0,
      "clickRate": 19.0
    },
    "automationTimeseries": [
      {
        "day": "2024-01-01",
        "sent": 50,
        "delivered": 47,
        "failed": 3
      }
    ],
    "automationPerformance": [
      {
        "type": "abandoned_checkout",
        "sent": 500,
        "delivered": 475,
        "clicked": 95,
        "deliveryRate": 95.0,
        "clickRate": 19.0
      }
    ],
    "dateRange": {
      "from": "2024-01-01T00:00:00Z",
      "to": "2024-01-31T23:59:59Z"
    }
  }
}
```

### 5. Messaging Reports

**GET** `/reports/messaging`

Get messaging analytics and performance metrics.

#### Query Parameters

| Parameter     | Type   | Default | Description           |
| ------------- | ------ | ------- | --------------------- |
| `from`        | string | -       | Start date (ISO 8601) |
| `to`          | string | -       | End date (ISO 8601)   |
| `messageType` | string | -       | Message type filter   |
| `status`      | string | -       | Message status filter |

#### Response

```json
{
  "success": true,
  "data": {
    "messagingTimeseries": [
      {
        "day": "2024-01-01",
        "sent": 150,
        "delivered": 142,
        "failed": 8,
        "cost": 4.5
      }
    ],
    "messagingStats": {
      "totalSent": 5000,
      "totalDelivered": 4750,
      "totalFailed": 250,
      "deliveryRate": 95.0,
      "averageCost": 0.03
    },
    "deliveryRates": {
      "overall": 95.0,
      "byType": {
        "campaign": 96.0,
        "automation": 94.0
      },
      "byHour": [
        {
          "hour": 9,
          "deliveryRate": 98.0
        }
      ]
    },
    "failureReasons": [
      {
        "reason": "Invalid phone number",
        "count": 150,
        "percentage": 60.0
      }
    ],
    "dateRange": {
      "from": "2024-01-01T00:00:00Z",
      "to": "2024-01-31T23:59:59Z"
    }
  }
}
```

### 6. Revenue Reports

**GET** `/reports/revenue`

Get revenue analytics and attribution metrics.

#### Query Parameters

| Parameter | Type   | Default | Description           |
| --------- | ------ | ------- | --------------------- |
| `from`    | string | -       | Start date (ISO 8601) |
| `to`      | string | -       | End date (ISO 8601)   |

#### Response

```json
{
  "success": true,
  "data": {
    "revenueOverview": {
      "totalRevenue": 2250.0,
      "attributedRevenue": 1800.0,
      "attributionRate": 80.0,
      "averageOrderValue": 50.0,
      "totalOrders": 45
    },
    "revenueByCampaign": [
      {
        "campaignId": "campaign_123",
        "campaignName": "Summer Sale",
        "revenue": 1200.0,
        "orderCount": 24,
        "discountCode": "SUMMER20"
      }
    ],
    "revenueByAutomation": [
      {
        "automation": "abandoned_checkout",
        "revenue": 600.0,
        "orderCount": 12
      }
    ],
    "revenueTimeseries": [
      {
        "day": "2024-01-01",
        "revenue": 75.0,
        "orders": 3
      }
    ],
    "discountUtilization": {
      "totalCodes": 1000,
      "usedCodes": 150,
      "reservedCodes": 50,
      "availableCodes": 800,
      "utilizationRate": 15.0,
      "reservationRate": 5.0
    },
    "dateRange": {
      "from": "2024-01-01T00:00:00Z",
      "to": "2024-01-31T23:59:59Z"
    }
  }
}
```

### 7. Export Reports

**GET** `/reports/export`

Export reports data in various formats.

#### Query Parameters

| Parameter    | Type   | Default  | Description                                                        |
| ------------ | ------ | -------- | ------------------------------------------------------------------ |
| `from`       | string | -        | Start date (ISO 8601)                                              |
| `to`         | string | -        | End date (ISO 8601)                                                |
| `format`     | string | json     | Export format (json, csv)                                          |
| `reportType` | string | overview | Report type (overview, campaigns, automations, messaging, revenue) |

#### Response

**JSON Format:**

```json
{
  "success": true,
  "data": {
    // Report data based on reportType
  },
  "exportInfo": {
    "reportType": "overview",
    "format": "json",
    "dateRange": {
      "from": "2024-01-01T00:00:00Z",
      "to": "2024-01-31T23:59:59Z"
    },
    "exportedAt": "2024-01-15T10:30:00Z"
  }
}
```

**CSV Format:**
Returns CSV file with appropriate headers and data.

## Data Models

### Overview Metrics

| Field                 | Type    | Description               |
| --------------------- | ------- | ------------------------- |
| `sent`                | integer | Total messages sent       |
| `delivered`           | integer | Total messages delivered  |
| `failed`              | integer | Total messages failed     |
| `deliveryRate`        | number  | Delivery rate percentage  |
| `cost`                | number  | Total cost                |
| `optIns`              | integer | New opt-ins               |
| `optOuts`             | integer | Opt-outs                  |
| `attributedOrders`    | object  | Order attribution metrics |
| `revenueByCampaign`   | array   | Revenue by campaign       |
| `discountUtilization` | object  | Discount code utilization |

### Campaign Attribution

| Field             | Type    | Description                  |
| ----------------- | ------- | ---------------------------- |
| `campaignId`      | string  | Campaign identifier          |
| `name`            | string  | Campaign name                |
| `revenue`         | number  | Attributed revenue           |
| `orders`          | integer | Attributed orders            |
| `via`             | object  | Attribution method breakdown |
| `clicks_lifetime` | integer | Total clicks                 |
| `messaging`       | object  | Messaging metrics            |

### Messaging Timeseries

| Field       | Type    | Description        |
| ----------- | ------- | ------------------ |
| `day`       | string  | Date (YYYY-MM-DD)  |
| `sent`      | integer | Messages sent      |
| `delivered` | integer | Messages delivered |
| `failed`    | integer | Messages failed    |
| `cost`      | number  | Cost for the day   |

## Error Responses

### 400 Bad Request

```json
{
  "error": "invalid_date_range",
  "message": "Invalid date range provided"
}
```

### 404 Not Found

```json
{
  "error": "campaign_not_found",
  "message": "Campaign not found"
}
```

### 500 Internal Server Error

```json
{
  "error": "reports_overview_failed",
  "message": "Failed to fetch reports overview"
}
```

## Rate Limits

- **Overview**: 50 requests per minute
- **Campaigns**: 30 requests per minute
- **Automations**: 30 requests per minute
- **Messaging**: 30 requests per minute
- **Revenue**: 30 requests per minute
- **Export**: 10 requests per minute

## Examples

### Get Overview Report

```bash
curl -X GET "/reports/overview?from=2024-01-01&to=2024-01-31" \
  -H "Authorization: Bearer YOUR_SESSION_TOKEN" \
  -H "X-Shopify-Shop-Domain: your-shop.myshopify.com"
```

### Get Campaign Reports

```bash
curl -X GET "/reports/campaigns?from=2024-01-01&to=2024-01-31&limit=10" \
  -H "Authorization: Bearer YOUR_SESSION_TOKEN" \
  -H "X-Shopify-Shop-Domain: your-shop.myshopify.com"
```

### Export Campaign Report

```bash
curl -X GET "/reports/export?from=2024-01-01&to=2024-01-31&format=csv&reportType=campaigns" \
  -H "Authorization: Bearer YOUR_SESSION_TOKEN" \
  -H "X-Shopify-Shop-Domain: your-shop.myshopify.com"
```

## Frontend Integration

The Reports page is designed to work seamlessly with Shopify App frontend using Polaris components. See `frontend-examples/Reports.tsx` for a complete implementation example.

### Key Features

- **Comprehensive Dashboard**: Overview, campaigns, automations, messaging, and revenue tabs
- **Date Range Selection**: Flexible date range picker with preset options
- **Advanced Analytics**: Detailed metrics and performance indicators
- **Export Functionality**: Export reports in JSON or CSV format
- **Interactive Charts**: Visual representations of data trends
- **Performance Metrics**: Delivery rates, click rates, and revenue attribution
- **Professional Design**: Clean, intuitive interface for data analysis

### Report Workflow

1. **Select Date Range**: Choose analysis period
2. **View Overview**: Get comprehensive metrics summary
3. **Analyze Campaigns**: Review campaign performance and attribution
4. **Monitor Automations**: Track automation effectiveness
5. **Review Messaging**: Analyze messaging performance over time
6. **Track Revenue**: Monitor revenue attribution and trends
7. **Export Data**: Download reports for further analysis

## Best Practices

### ✅ **Do**

- Use appropriate date ranges for analysis
- Monitor key metrics regularly
- Export data for external analysis
- Track attribution rates
- Monitor delivery and click rates
- Analyze revenue trends

### ❌ **Don't**

- Ignore delivery rate drops
- Overlook attribution metrics
- Forget to monitor automation performance
- Ignore revenue trends
- Skip regular reporting
- Overlook failure reasons

## Support

For reports-related questions:

- **Analytics**: Understanding metrics and KPIs
- **Attribution**: Tracking campaign and automation ROI
- **Export**: Data export and analysis
- **Performance**: Optimizing delivery and click rates
- **Revenue**: Revenue attribution and tracking
